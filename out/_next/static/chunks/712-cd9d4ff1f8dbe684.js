"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[712],{6356:(e,t,n)=>{n.d(t,{AP:()=>i,Ag:()=>c});let o="buan-learner-profile";function r(e){return{id:e,lastUpdated:new Date().toISOString(),knowledgeLevel:"unknown",learningPace:"unknown",learningPreferences:{detailedExplanations:5,examples:5,visualLearning:5,practicalApplications:5,interactiveQuestions:5},topics:{},interactionCount:0,questionTypes:{factual:0,conceptual:0,analytical:0,applicationBased:0},averageMessageLength:0,responsePreference:"unknown"}}function a(e){try{let t=localStorage.getItem(o);if(t){let n=JSON.parse(t);if(n.id!==e){let t=r(e);return s(t),t}return n}let n=r(e);return s(n),n}catch(n){console.error("Error retrieving learner profile:",n);let t=r(e);return s(t),t}}function s(e){try{e.lastUpdated=new Date().toISOString(),localStorage.setItem(o,JSON.stringify(e))}catch(e){console.error("Error saving learner profile:",e)}}function i(e,t,n){let o=a(e);o.interactionCount+=1;let r=o.averageMessageLength*(o.interactionCount-1);o.averageMessageLength=(r+t.length)/o.interactionCount,n&&""!==n.trim()&&(o.topics[n]||(o.topics[n]={knowledgeLevel:"unknown",interactionCount:0,lastInteraction:new Date().toISOString()}),o.topics[n].interactionCount+=1,o.topics[n].lastInteraction=new Date().toISOString());let i=t.toLowerCase();return i.includes("what is")||i.includes("who is")||i.includes("when did")?o.questionTypes.factual+=1:i.includes("why")||i.includes("how does")?o.questionTypes.conceptual+=1:i.includes("analyze")||i.includes("compare")||i.includes("evaluate")?o.questionTypes.analytical+=1:(i.includes("apply")||i.includes("use")||i.includes("implement"))&&(o.questionTypes.applicationBased+=1),o.interactionCount>5&&(o.averageMessageLength<50?o.responsePreference="concise":o.averageMessageLength>150?o.responsePreference="detailed":o.responsePreference="balanced"),s(o),o}function c(e){let t=a(e);if(t.interactionCount<3)return"";let n="LEARNER PROFILE:\n";"unknown"!==t.knowledgeLevel&&(n+="- Knowledge level: ".concat(t.knowledgeLevel,"\n")),"unknown"!==t.learningPace&&(n+="- Learning pace: ".concat(t.learningPace,"\n")),"unknown"!==t.responsePreference&&(n+="- Prefers ".concat(t.responsePreference," responses\n")),n+="- Learning preferences: ";let o=[];t.learningPreferences.detailedExplanations>7&&o.push("detailed explanations"),t.learningPreferences.examples>7&&o.push("numerous examples"),t.learningPreferences.visualLearning>7&&o.push("visual learning"),t.learningPreferences.practicalApplications>7&&o.push("practical applications"),t.learningPreferences.interactiveQuestions>7&&o.push("interactive questions"),n+=o.length>0?o.join(", "):"balanced approach",n+="\n";let r=Object.entries(t.topics).sort((e,t)=>t[1].interactionCount-e[1].interactionCount).slice(0,3);return r.length>0&&(n+="- Topics of interest: ",n+=r.map(e=>{let[t]=e;return t}).join(", "),n+="\n"),n}},18956:(e,t,n)=>{n.d(t,{$:()=>l,t:()=>u});var o=n(95155),r=n(12115),a=n(23475);let s=n(49509).env.NEXT_PUBLIC_LLM_SERVER_URL||"http://127.0.0.1:3300",i={getAllDocuments:async()=>{try{let e=await fetch("".concat(s,"/documents"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to fetch documents: ".concat(e.status))}return await e.json()}catch(e){throw console.error("Error fetching documents:",e),e}},uploadDocument:async e=>{try{let t=new FormData;t.append("file",e);let n=await fetch("".concat(s,"/documents/upload"),{method:"POST",body:t});if(!n.ok){let e=await n.json();throw Error(e.error||"Failed to upload document: ".concat(n.status))}return await n.json()}catch(e){throw console.error("Error uploading document:",e),e}},deleteDocument:async e=>{try{let t=await fetch("".concat(s,"/documents/").concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to delete document: ".concat(t.status))}}catch(e){throw console.error("Error deleting document:",e),e}},searchDocuments:async e=>{try{let t=await fetch("".concat(s,"/documents/search?q=").concat(encodeURIComponent(e)),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to search documents: ".concat(t.status))}return await t.json()}catch(e){throw console.error("Error searching documents:",e),e}}},c=(0,r.createContext)(void 0);function l(e){let{children:t}=e,{user:n}=(0,a.A)(),[s,l]=(0,r.useState)([]),[u,d]=(0,r.useState)(!1),[g,m]=(0,r.useState)(null),h=e=>e.map(e=>({...e,uploadedAt:"string"==typeof e.uploadedAt?new Date(e.uploadedAt):e.uploadedAt})),p=(0,r.useCallback)(async()=>{d(!0),m(null);try{let e=await i.getAllDocuments();l(h(e))}catch(e){console.error("Error fetching documents:",e),m(e instanceof Error?e.message:"Failed to fetch documents")}finally{d(!1)}},[]),f=(0,r.useCallback)(async e=>{d(!0),m(null);try{let t=await i.uploadDocument(e);l(e=>[...e,h([t])[0]])}catch(e){throw console.error("Error uploading document:",e),m(e instanceof Error?e.message:"Failed to upload document"),e}finally{d(!1)}},[]),v=(0,r.useCallback)(async e=>{d(!0),m(null);try{await i.deleteDocument(e),l(t=>t.filter(t=>t.id!==e))}catch(e){throw console.error("Error deleting document:",e),m(e instanceof Error?e.message:"Failed to delete document"),e}finally{d(!1)}},[]),w=(0,r.useCallback)(async e=>{d(!0),m(null);try{let t=await i.searchDocuments(e);l(h(t))}catch(e){console.error("Error searching documents:",e),m(e instanceof Error?e.message:"Failed to search documents")}finally{d(!1)}},[]);return(0,o.jsx)(c.Provider,{value:{documents:s,isLoading:u,error:g,uploadDocument:f,deleteDocument:v,searchDocuments:w,refreshDocuments:p},children:t})}function u(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useLibrary must be used within a LibraryProvider");return e}},23475:(e,t,n)=>{n.d(t,{A:()=>l,O:()=>c});var o=n(95155),r=n(12115),a=n(94486),s=n(39605);let i=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[n,c]=(0,r.useState)(null),[l,u]=(0,r.useState)(!0),[d,g]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{f(!(0,a.sc)());let e=()=>f(!1),t=()=>f(!0);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);let v=e=>"".concat("buan-guest-user-").concat(e);(0,r.useEffect)(()=>{(async()=>{u(!0);try{let e=localStorage.getItem(s.mS.ACTIVE_GUEST_ROLE);if("student"===e||"teacher"===e){let t=localStorage.getItem(v(e));if(t){let n=JSON.parse(t);c({...n,emailConfirmed:!0}),h(!0),g(!0),console.log("Logged in as guest ".concat(e,": ").concat(n.name))}else c(null),h(!1),g(!1)}else c(null),h(!1),g(!1)}catch(e){console.error("Error initializing auth:",e),c(null),h(!1),g(!1)}finally{u(!1)}})()},[]),(0,r.useEffect)(()=>{g(!!n&&n.id.startsWith("guest-"))},[n]);let w=async(e,t)=>{u(!0);try{let t="student",n={id:"guest-".concat(Date.now()),email:e,name:e.split("@")[0],role:t,emailConfirmed:!0};return localStorage.setItem(v(t),JSON.stringify(n)),localStorage.setItem(s.mS.ACTIVE_GUEST_ROLE,t),c(n),g(!0),h(!0),{success:!0}}catch(e){return console.error("Login error:",e),{success:!1,error:"Failed to login"}}finally{u(!1)}},y=async(e,t,n,o)=>{u(!0);try{let n={id:"guest-".concat(Date.now()),email:t,name:e,role:o,emailConfirmed:!0};return localStorage.setItem(v(o),JSON.stringify(n)),localStorage.setItem(s.mS.ACTIVE_GUEST_ROLE,o),c(n),g(!0),h(!0),{success:!0,redirectToLogin:!1}}catch(e){return console.error("Signup error:",e),{success:!1,error:"Failed to sign up"}}finally{u(!1)}},E=async()=>{u(!0);try{(null==n?void 0:n.role)&&localStorage.removeItem(v(n.role)),localStorage.removeItem(s.mS.ACTIVE_GUEST_ROLE),c(null),g(!1),h(!1)}catch(e){console.error("Logout error:",e)}finally{u(!1)}},I=async e=>({success:!1,error:"Password reset not available in guest mode"}),S=async e=>({success:!1,error:"Password update not available in guest mode"});return(0,o.jsx)(i.Provider,{value:{user:n,isLoading:l,isAuthenticated:!!n,isGuest:d,isEmailConfirmed:m,isOffline:p,login:w,signup:y,logout:E,continueAsGuest:e=>{let t={id:"guest-".concat(Date.now()),email:"guest-".concat(Date.now(),"@example.com"),name:"Guest ".concat(e),role:e,emailConfirmed:!0};localStorage.setItem(v(e),JSON.stringify(t)),localStorage.setItem(s.mS.ACTIVE_GUEST_ROLE,e),c(t),g(!0),h(!0)},resetPassword:I,updatePassword:S},children:t})}let l=()=>{let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},39605:(e,t,n)=>{n.d(t,{CJ:()=>c,QF:()=>d,W8:()=>l,Yy:()=>u,dn:()=>a,fm:()=>s,mS:()=>r,mi:()=>i});var o=n(51368);let r={ACTIVE_GUEST_ROLE:"buan-active-guest-role",GUEST_USER_PREFIX:"buan-guest-user-",GUEST_EXPIRY_PREFIX:"buan-guest-user-expiry-"};function a(){let e=localStorage.getItem(r.ACTIVE_GUEST_ROLE);return"student"===e||"teacher"===e?e:null}function s(e){e?(localStorage.setItem(r.ACTIVE_GUEST_ROLE,e),console.log("Set active guest role: ".concat(e))):(localStorage.removeItem(r.ACTIVE_GUEST_ROLE),console.log("Cleared active guest role"))}function i(){s(null)}function c(e){let t="".concat(r.GUEST_USER_PREFIX).concat(e),n="".concat(r.GUEST_EXPIRY_PREFIX).concat(e),o=localStorage.getItem(t),a=localStorage.getItem(n);return!!o&&!!a&&(!(new Date(a)<new Date)||(u(e),!1))}function l(e){let t={id:"guest-".concat(e,"-").concat((0,o.A)().slice(0,8)),email:"",name:"Guest ".concat(e.charAt(0).toUpperCase()+e.slice(1)),role:e,createdAt:new Date().toISOString(),emailConfirmed:!0},n="".concat(r.GUEST_USER_PREFIX).concat(e),a="".concat(r.GUEST_EXPIRY_PREFIX).concat(e);return localStorage.setItem(n,JSON.stringify(t)),localStorage.setItem(a,new Date(Date.now()+1728e7).toISOString()),console.log("Created new guest user for role: ".concat(e)),t}function u(e){let t="".concat(r.GUEST_USER_PREFIX).concat(e),n="".concat(r.GUEST_EXPIRY_PREFIX).concat(e);localStorage.removeItem(t),localStorage.removeItem(n),a()===e&&i(),console.log("Cleared guest data for role: ".concat(e))}function d(){try{["student","teacher"].forEach(e=>{let t="".concat(r.GUEST_USER_PREFIX).concat(e),n="".concat(r.GUEST_EXPIRY_PREFIX).concat(e),o=localStorage.getItem(t),a=localStorage.getItem(n);o&&a&&new Date(a)<new Date&&(localStorage.removeItem(t),localStorage.removeItem(n),console.log("Cleared expired guest account for role: ".concat(e)))})}catch(e){console.error("Error cleaning up expired guest accounts:",e)}}},50067:(e,t,n)=>{n.d(t,{I:()=>g,m:()=>m});var o=n(95155),r=n(12115),a=n(53574),s=n(51073);let i=n(49509).env.NEXT_PUBLIC_PICOVOICE_ACCESS_KEY||"AqWdpv4Yxo/kGhiesb4ZRX7Ru6A89vJMPOJXt9UCMgZq6IRgK2dN0A==",c="/ai/cheetah_params.pv",l="cheetah_initialized",u=()=>Math.random().toString(36).substring(2,11),d=(0,r.createContext)(void 0);function g(e){let{children:t}=e,[n,g]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1),[v,w]=(0,r.useState)("undefined"==typeof navigator||navigator.onLine),y=(0,r.useRef)(!1),E=(0,r.useRef)(!1),I=(0,r.useRef)({}),S=e=>{Object.values(I.current).forEach(t=>{try{t(e)}catch(e){console.error("Error in transcript callback:",e)}})};(0,r.useEffect)(()=>{let e=()=>w(!0),t=()=>w(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);let b=async()=>{try{if(E.current)return!0;let e=(await fetch(c,{method:"HEAD"})).ok;return e?(console.log("Cheetah model file found"),E.current=!0):console.error("Cheetah model file not found:",c),e}catch(e){return console.error("Error checking model file:",e),!1}},C=async()=>{if(y.current)return null;y.current=!0,h(!0);try{if(!i)throw Error("Picovoice access key is missing. Please set NEXT_PUBLIC_PICOVOICE_ACCESS_KEY in your .env.local file.");console.log("Initializing Cheetah with accessKey:",i.substring(0,5)+"...");let e=await a.FN.create(i,S,{publicPath:c});return localStorage.setItem(l,"true"),f(!0),console.log("Cheetah initialized successfully for speech recognition"),e}catch(e){return console.error("Failed to initialize Cheetah:",e),localStorage.removeItem(l),f(!1),null}finally{y.current=!1,h(!1)}},L=async()=>{if(!n&&v&&await b()){let e=await C();e&&g(e)}};return(0,r.useEffect)(()=>{(async()=>{let e="true"===localStorage.getItem(l);f(e),e&&v&&!n&&!m&&await L()})()},[v,n,m]),(0,r.useEffect)(()=>()=>{if(n)try{s.n8.unsubscribe(n),n.release().catch(console.error)}catch(e){console.error("Error releasing Cheetah:",e)}},[n]),(0,r.useEffect)(()=>{!v||n||m||y.current||L()},[v,n,m]),(0,o.jsx)(d.Provider,{value:{cheetah:n,isInitializing:m,isInitialized:p,isOnline:v,initSpeechRecognition:L,registerTranscriptCallback:e=>{let t=u();return I.current[t]=e,t},unregisterTranscriptCallback:e=>{I.current[e]&&delete I.current[e]}},children:t})}function m(){let e=(0,r.useContext)(d);if(void 0===e)throw Error("useSpeech must be used within a SpeechProvider");return e}},70957:(e,t,n)=>{n.d(t,{k:()=>I,Y:()=>S});var o=n(95155),r=n(12115),a=n(51368),s=n(23475),i=n(35695),c=n(94486),l=n(6356);let u=n(49509).env.NEXT_PUBLIC_LLM_SERVER_URL||"http://127.0.0.1:3300",d={async generateResponse(e,t,n,o){try{let r=[];if(t){let e="";if("teacher"===t)e="You are an AI teaching assistant designed to help educators with curriculum development, \n          lesson planning, assessment design, and classroom management. You provide evidence-based teaching strategies \n          and resources to support effective instruction. Provide concise, practical advice that teachers can implement\n          immediately in their classrooms.";else{let t="";o&&(t=(0,l.Ag)(o)),e="You are an AI tutor named Baun designed to provide exceptional educational assistance. Your main goal is to help students truly understand concepts through clear, step-by-step explanations.\n\nCORE PRINCIPLES:\n1. Break down complex concepts into simple, digestible steps\n2. Adapt your teaching approach based on the student's responses and needs\n3. Provide concrete examples to illustrate abstract concepts\n4. Use analogies to connect new information to familiar concepts\n5. Check for understanding regularly and adjust your explanations accordingly\n\nLEARNING PROFILE ADAPTATION:\nAs you interact with the student, analyze their messages to identify:\n- Their current knowledge level (beginner, intermediate, advanced)\n- Their learning pace (do they grasp concepts quickly or need more time?)\n- Areas where they struggle or need additional support\n- Their learning preferences (detailed explanations, examples, applications, etc.)\n\nAdjust your teaching approach based on these observations without explicitly mentioning that you're doing so.\n\nEXPLANATION STRUCTURE:\n1. Start with a brief, simple overview of the concept\n2. Break down the concept into clearly defined steps or components\n3. Provide examples or illustrations for each step\n4. Connect the concept to real-world applications\n5. Summarize the key points at the end\n\nINTERACTION GUIDELINES:\n- If a question is unclear, ask for clarification before providing a full answer\n- If a student seems confused, try a different approach to explain the same concept\n- Encourage questions and emphasize that confusion is a normal part of learning\n- Be patient, supportive, and encouraging throughout the learning process\n- Ask follow-up questions to check understanding\n\nFORMATTING:\n- Present information in a clear, organized manner\n- Use numbered steps for processes or sequences\n- Use plain language and avoid jargon unless necessary for the subject.\n- Use markdown formatting like bold, italics, or headings where appropriate.\n\n".concat(t,"\n\nRemember, your purpose is to help students build genuine understanding, not just provide answers. Guide them through the thinking process to develop their problem-solving skills.")}r.push({role:"system",content:e})}if(n&&n.length>0){let e=n.slice(-3);r.push(...e.map(e=>({role:e.role,content:e.content})))}return r.push({role:"user",content:e}),(await this.chatCompletion({messages:r,temperature:.7,max_tokens:1e3})).choices[0].message.content.split("\n").map(e=>e.replace(/^(User:|Assistant:|System:)\s*/i,"").replace(/^<\|assistant\|\>\s*/i,"").replace(/^<\|user\|\>\s*/i,"").replace(/^<\|system\|\>\s*/i,"").trim()).filter(e=>e.length>0).join("\n").trim()}catch(e){throw console.error("Error generating response:",e),e}},async chatCompletion(e){try{let t=await fetch("".concat(u,"/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Local LLM server returned ".concat(t.status,": ").concat(await t.text()));return await t.json()}catch(e){throw console.error("Error calling local LLM server:",e),e}},async isAvailable(){try{return(await fetch("".concat(u,"/health"),{method:"GET"})).ok}catch(e){return!1}},async getServerInfo(){try{let e=await fetch("".concat(u,"/"),{method:"GET"});if(!e.ok)throw Error("Local LLM server returned ".concat(e.status,": ").concat(await e.text()));return await e.json()}catch(e){throw console.error("Error getting local LLM server info:",e),e}}};var g=n(79979),m=n(49509);m.env.NEXT_PUBLIC_LOCAL_LLM_PREFERRED;let h={generateResponse:async(e,t,n,o)=>{let r=!navigator.onLine;try{return console.log("Attempting to use local LLM service"),await d.generateResponse(e,t,n,o)}catch(a){if(console.log("Local LLM failed:",a),r)return console.log("Device is offline and local LLM failed - returning offline message"),function(e,t){let n=e.toLowerCase();return"teacher"===t?"I'm currently in offline mode, but I can still help with your teaching needs.\n    \nWhen you're back online, I'll be able to provide more detailed assistance with your ".concat(n.includes("lesson")?"lesson planning":"teaching question",".\n\nIn the meantime, you can continue brainstorming ideas and I'll store our conversation for later reference."):"I'm currently in offline mode, but I can still help with your learning.\n    \nWhen you're back online, I'll be able to provide more detailed explanations about ".concat(n.includes("math")?"this math problem":"this topic",".\n\nIn the meantime, you can continue asking questions and I'll store our conversation for later reference.")}(e,t);if("true"===m.env.NEXT_PUBLIC_DISABLE_GROQ_FALLBACK)return"The local LLM server is not responding and fallback to online services is disabled. Please check that your local LLM server is running correctly.";try{return console.log("Falling back to Groq service"),await g.B.generateResponse(e,t,n,o)}catch(e){return console.error("Groq API also failed:",e),"Sorry, I'm having trouble generating a response. The local LLM failed and the Groq API is also unavailable. Please check your connection or try again later."}}}},p=e=>e.map(e=>({role:"user"===e.role?"user":"assistant",content:e.content})),f={sendMessage:async(e,t,n,o)=>{let r=(0,a.A)(),s=(0,a.A)();try{var i;let a=(await (0,c.lS)()).find(e=>e.id===t),l=(null==a?void 0:null===(i=a.messages)||void 0===i?void 0:i.slice(-10))||[],u=p(l);try{return{response:await h.generateResponse(e,n,u,o||(null==a?void 0:a.userId)||null),messageId:r,responseId:s,offline:!navigator.onLine}}catch(e){return console.error("Error generating response:",e),{response:"Sorry, I'm having trouble generating a response right now. ".concat(e.message||"Please try again later."),messageId:r,responseId:s,error:!0}}}catch(e){return console.error("Error sending message to API:",e),{response:"Sorry, I encountered an error while processing your request: ".concat(e.message||"Unknown error"),messageId:r,responseId:s,error:!0}}},getConversations:async(e,t)=>{try{console.log("API getConversations called with role: ".concat(e,", userId: ").concat(t||"null"));let n=await (0,c.lS)();console.log("Retrieved ".concat(n.length," local conversations"));let o=n;return e&&(o=n.filter(t=>{if(void 0!==t.userRole){let n=t.userRole===e;return n||console.log("Filtering out conversation ".concat(t.id," with role ").concat(t.userRole," (current role: ").concat(e,")")),n}return console.log("Conversation ".concat(t.id," has no userRole property, excluding")),!1}),console.log("Filtered from ".concat(n.length," to ").concat(o.length," conversations for role: ").concat(e))),o}catch(e){return console.error("Error in getConversations:",e),[]}},syncConversation:async e=>{try{return await (0,c.vm)(e),!0}catch(e){return console.error("Error saving conversation:",e),!1}}};function v(){let e=window.location.pathname;return(console.log("Detecting role from URL path: ".concat(e)),e.includes("/tutor"))?(console.log("URL path indicates student role"),"student"):e.includes("/teaching-assistant")?(console.log("URL path indicates teacher role"),"teacher"):(console.log("No specific role detected from URL"),null)}let w=(0,r.createContext)(void 0),y="buan-conversations-",E="buan-current-conversation-";function I(e){let{children:t}=e,{user:n}=(0,s.A)(),l=(0,i.usePathname)(),[u,d]=(0,r.useState)([]),[g,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),[I,S]=(0,r.useState)(null),[b,C]=(0,r.useState)(!(0,c.sc)()),L=["Explain the concept of photosynthesis in simple terms","Help me understand how to solve quadratic equations","What are the key events of World War II?","Explain Newton's laws of motion with examples"],R=["Create a lesson plan for teaching linear equations to 8th graders","Suggest activities for teaching the water cycle","How can I explain cellular respiration to high school students?","Generate a rubric for a research paper assignment"],[P,D]=(0,r.useState)(L);(0,r.useEffect)(()=>{(async()=>{try{console.log("Running initial cleanup of conversations with missing roles"),await (0,c.LO)()}catch(e){console.error("Error during initial conversation cleanup:",e)}})()},[]),(0,r.useEffect)(()=>{let e=v();e&&(console.log("Setting role from URL: ".concat(e)),S(e))},[]),(0,r.useEffect)(()=>{let e=()=>C(!1),t=()=>C(!0);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),(0,r.useEffect)(()=>{let e=v();(null==n?void 0:n.role)&&!e&&(console.log("Setting role from user: ".concat(n.role)),S(n.role))},[null==n?void 0:n.role]),(0,r.useEffect)(()=>{I&&g&&g.userRole!==I&&m(null)},[I,g]),(0,r.useEffect)(()=>{let e=v()||(null==n?void 0:n.role)||I;e&&(S(e),(async()=>{try{p(!0),console.log("Loading conversations for role: ".concat(e,", userId: ").concat((null==n?void 0:n.id)||"guest"));let t=await f.getConversations(e,(null==n?void 0:n.id)||null);if(console.log("Fetched ".concat(t.length," conversations for role: ").concat(e)),t&&t.length>0){let o=t.map(t=>({id:t.id,title:t.title,messages:t.messages.map(e=>({id:e.id,role:e.role,content:e.content,timestamp:new Date(e.timestamp),status:"sending"===e.status?"pending":"error"===e.status?"error":"sent"===e.status?"complete":void 0})),lastUpdated:new Date(t.lastUpdated),userRole:e,userId:t.userId||(null==n?void 0:n.id)||null}));console.log("Formatted ".concat(o.length," conversations for role: ").concat(e)),d(o);let r="".concat(E).concat(e),a=localStorage.getItem(r);if(console.log("Current conversation ID from localStorage for ".concat(e,": ").concat(a)),a){let e=o.find(e=>e.id===a)||null;e?(console.log("Restoring current conversation: ".concat(e.id," with ").concat(e.messages.length," messages")),m(e)):(console.log("Could not find conversation with ID: ".concat(a)),o.length>0&&(console.log("Using most recent conversation instead: ".concat(o[0].id)),m(o[0]),localStorage.setItem(r,o[0].id)))}else o.length>0&&(console.log("No current conversation ID found, using most recent: ".concat(o[0].id)),m(o[0]),localStorage.setItem(r,o[0].id))}else console.log("No conversations found for role: ".concat(e)),setTimeout(()=>{console.log("Creating a new conversation for role: ".concat(e)),A(e)},0)}catch(e){console.error("Error loading conversations:",e)}finally{p(!1)}})(),"teacher"===e?D(R):D(L))},[null==n?void 0:n.role,null==n?void 0:n.id]),(0,r.useEffect)(()=>{(async()=>{if(u.length>0&&!h)try{for(let e of u){let t={id:e.id,title:e.title,messages:e.messages.map(e=>({id:e.id,role:e.role,content:e.content,timestamp:e.timestamp.toISOString(),status:"pending"===e.status?"sending":"error"===e.status?"error":"complete"===e.status?"sent":void 0})),lastUpdated:e.lastUpdated.toISOString(),userId:e.userId,userRole:e.userRole};await f.syncConversation(t)}if(g){let e="".concat(E).concat(I||(null==n?void 0:n.role));localStorage.setItem(e,g.id)}}catch(e){console.error("Error saving conversations:",e)}})()},[u,g,I,null==n?void 0:n.role,h]);let A=async e=>{console.log("Creating new conversation for role: ".concat(e));let t=(0,a.A)(),o=!(null==n?void 0:n.id)||n.id.startsWith("guest-"),r={id:t,title:"New Conversation",messages:[],lastUpdated:new Date,userRole:e,userId:o?"guest-".concat((0,a.A)().slice(0,8)):(null==n?void 0:n.id)||null};console.log("Created conversation with ID: ".concat(r.id,", for user: ").concat(r.userId)),d(e=>[r,...e]),m(r);let s="".concat(E).concat(e);await (0,c.RC)(s,r.id),localStorage.setItem(s,r.id);let i={id:r.id,title:r.title,messages:[],lastUpdated:r.lastUpdated.toISOString(),userId:r.userId,userRole:e};return console.log("Syncing new conversation to storage: ".concat(r.id," with role: ").concat(e)),await f.syncConversation(i),r.id},T=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!g)return;let o={id:(0,a.A)(),role:"user",content:e,timestamp:new Date,status:"complete",attachments:t},r=g.title,s=[...g.messages,o];0===g.messages.length&&(r=e.slice(0,30)+(e.length>30?"...":""));let i={...g,title:r,messages:s,lastUpdated:new Date};if(m(i),d(e=>e.map(e=>e.id===g.id?i:e)),b){let t=N(e,g.userRole),n={id:(0,a.A)(),role:"assistant",content:t,timestamp:new Date,status:"complete"},o={...i,messages:[...i.messages,n],lastUpdated:new Date};m(o),d(e=>e.map(e=>e.id===g.id?o:e))}else try{p(!0);let{response:t,responseId:o}=await f.sendMessage(e,g.id,g.userRole,g.userId||(null==n?void 0:n.id)||null),r={id:o,role:"assistant",content:t,timestamp:new Date,status:"complete"},a={...i,messages:[...i.messages,r],lastUpdated:new Date};m(a),d(e=>e.map(e=>e.id===g.id?a:e))}catch(o){console.error("Error getting AI response:",o);let e="I'm sorry, I encountered an error while processing your request.";o instanceof Error&&(o.message.includes("timeout")||o.message.includes("abort")||o.message.includes("network")?e="I'm sorry, but it's taking me longer than expected to process your request. The local AI model is running on limited hardware and may need more time for complex questions. Please try a simpler question or wait a moment before trying again.":o.message.includes("JSON")&&(e="I received a response but couldn't process it correctly. This could happen when the local AI model is overloaded. Please try a simpler question or wait a moment before trying again."));let t={id:(0,a.A)(),role:"assistant",content:e,timestamp:new Date,status:"error"},n={...i,messages:[...i.messages,t],lastUpdated:new Date};m(n),d(e=>e.map(e=>e.id===g.id?n:e))}finally{p(!1)}},U=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"complete";if(!g)return;let o=g.messages.map(o=>o.id===e?{...o,content:t,status:n,timestamp:new Date}:o),r={...g,messages:o,lastUpdated:new Date};m(r),d(e=>e.map(e=>e.id===g.id?r:e))},x=async(e,t)=>{d(n=>n.map(n=>n.id===e?{...n,title:t,lastUpdated:new Date}:n)),g&&g.id===e&&m({...g,title:t,lastUpdated:new Date})},_=async e=>{try{if(await (0,c.Vz)(e),d(t=>t.filter(t=>t.id!==e)),(null==g?void 0:g.id)===e&&m(null),I){let t="".concat(E).concat(I);localStorage.getItem(t)===e&&localStorage.removeItem(t)}}catch(e){console.error("Error deleting conversation:",e)}},k=async()=>{let e=(null==n?void 0:n.role)||I;e&&(d(t=>t.filter(t=>t.userRole!==e)),g&&g.userRole===e&&(m(null),await (0,c.RC)("".concat(E).concat(e),null),localStorage.removeItem("".concat(E).concat(e))),await (0,c.RC)("".concat(y).concat(e),[]),localStorage.removeItem("".concat(y).concat(e)))},N=(e,t)=>{let n=e.toLowerCase();return"teacher"===t?"I'm currently in offline mode, but I can still help with your teaching needs.\n      \nWhen you're back online, I'll be able to provide more detailed assistance with your ".concat(n.includes("lesson")?"lesson planning":"teaching question",".\n\nIn the meantime, you can continue brainstorming ideas and I'll store our conversation for later reference."):"I'm currently in offline mode, but I can still help with your learning.\n      \nWhen you're back online, I'll be able to provide more detailed explanations about ".concat(n.includes("math")?"this math problem":"this topic",".\n\nIn the meantime, you can continue asking questions and I'll store our conversation for later reference.")};return(0,r.useEffect)(()=>{console.log("Path changed to: ".concat(l));let e=v();e&&(console.log("Updating role from URL change: ".concat(e)),S(e))},[l]),(0,o.jsx)(w.Provider,{value:{conversations:u,currentConversation:g,isLoading:h,currentRole:I,suggestedPrompts:P,createNewConversation:A,setCurrentConversationById:e=>{let t=u.find(t=>t.id===e);if(t){m(t);let o=(null==n?void 0:n.role)||I;o&&((0,c.RC)("".concat(E).concat(o),e),localStorage.setItem("".concat(E).concat(o),e))}},setCurrentRole:S,addMessage:T,updateMessage:U,renameConversation:x,deleteConversation:_,deleteAllConversations:k,isOffline:b},children:t})}function S(){let e=(0,r.useContext)(w);if(void 0===e)throw Error("useChat must be used within a ChatProvider");return e}},79979:(e,t,n)=>{n.d(t,{B:()=>r});var o=n(6356);let r={generateResponse:async(e,t,n,r)=>{try{if("student"===t&&r){let t="",n=e.toLowerCase();n.includes("math")||n.includes("equation")||n.includes("algebra")||n.includes("calculus")?t="Mathematics":n.includes("physics")||n.includes("force")||n.includes("energy")||n.includes("motion")?t="Physics":n.includes("chemistry")||n.includes("molecule")||n.includes("atom")||n.includes("reaction")?t="Chemistry":n.includes("biology")||n.includes("cell")||n.includes("organism")||n.includes("ecosystem")?t="Biology":n.includes("history")||n.includes("century")||n.includes("war")||n.includes("civilization")?t="History":n.includes("programming")||n.includes("code")||n.includes("function")||n.includes("algorithm")?t="Computer Science":(n.includes("literature")||n.includes("poem")||n.includes("novel")||n.includes("character"))&&(t="Literature"),(0,o.AP)(r,e,t)}let a=await fetch("/ai/api/groq",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,userRole:t,messageHistory:n,userId:r})});if(!a.ok){let e=await a.json();throw console.error("Groq API error response:",e),Error(e.error||"Failed to generate response: ".concat(a.status," ").concat(a.statusText))}return(await a.json()).response}catch(e){throw console.error("Error generating response from Groq service:",e),e}}}},94486:(e,t,n)=>{n.d(t,{LO:()=>u,Vz:()=>d,lS:()=>l,sc:()=>p,vm:()=>c,RC:()=>h});class o{init(){return new Promise((e,t)=>{if(!("indexedDB"in window)){t(Error("This browser doesn't support IndexedDB"));return}let n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=e=>{t(Error("Error opening database"))},n.onsuccess=t=>{e(!0)},n.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:"id"})}})}setItem(e,t){return new Promise((n,o)=>{let r=indexedDB.open(this.dbName,this.dbVersion);r.onerror=e=>{o(Error("Error opening database"))},r.onsuccess=r=>{let a=r.target.result.transaction([this.storeName],"readwrite").objectStore(this.storeName).put({id:e,data:t});a.onsuccess=()=>{n()},a.onerror=()=>{o(Error("Error storing data"))}}})}getItem(e){return new Promise((t,n)=>{let o=indexedDB.open(this.dbName,this.dbVersion);o.onerror=e=>{n(Error("Error opening database"))},o.onsuccess=o=>{let r=o.target.result.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);r.onsuccess=()=>{r.result?t(r.result.data):t(null)},r.onerror=()=>{n(Error("Error retrieving data"))}}})}removeItem(e){return new Promise((t,n)=>{let o=indexedDB.open(this.dbName,this.dbVersion);o.onerror=e=>{n(Error("Error opening database"))},o.onsuccess=o=>{let r=o.target.result.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);r.onsuccess=()=>{t()},r.onerror=()=>{n(Error("Error removing data"))}}})}clear(){return new Promise((e,t)=>{let n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=e=>{t(Error("Error opening database"))},n.onsuccess=n=>{let o=n.target.result.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();o.onsuccess=()=>{e()},o.onerror=()=>{t(Error("Error clearing data"))}}})}constructor(e,t,n=1){this.dbName=e,this.storeName=t,this.dbVersion=n}}let r="buan-tutor-db",a="conversations",s=null;async function i(){return s||(s=new Promise((e,t)=>{console.log("Initializing IndexedDB: ".concat(r,", version ").concat(1));try{let n=indexedDB.open(r,1);n.onerror=e=>{console.error("Error opening IndexedDB:",e),s=null,t(n.error)},n.onsuccess=t=>{console.log("IndexedDB initialized successfully");let n=t.target.result;n.onerror=e=>{console.error("IndexedDB error:",e)},e(n)},n.onupgradeneeded=e=>{console.log("Upgrading IndexedDB schema");let t=e.target.result;t.objectStoreNames.contains(a)||(console.log("Creating object store: ".concat(a)),t.createObjectStore(a,{keyPath:"id"}))}}catch(e){console.error("Critical error in IndexedDB initialization:",e),s=null,t(e)}}))}async function c(e){try{let t=await i();return new Promise((n,o)=>{try{let r=t.transaction([a],"readwrite"),s=r.objectStore(a).put(e);s.onerror=e=>{console.error("Error saving conversation to IndexedDB:",e),o(s.error)},s.onsuccess=()=>{console.log("Conversation saved successfully: ".concat(e.id)),n()},r.oncomplete=()=>{console.log("Transaction completed for conversation: ".concat(e.id))},r.onerror=e=>{console.error("Transaction error when saving conversation:",e)}}catch(e){console.error("Error creating transaction:",e),o(e)}})}catch(e){throw console.error("Error initializing IndexedDB for saving conversation:",e),e}}async function l(){try{let e=await i();return new Promise((t,n)=>{try{let o=e.transaction([a],"readonly").objectStore(a).getAll();o.onerror=e=>{console.error("Error getting conversations from IndexedDB:",e),n(o.error)},o.onsuccess=()=>{console.log("Retrieved ".concat(o.result?o.result.length:0," conversations")),t(o.result||[])}}catch(e){console.error("Error creating transaction for getConversations:",e),n(e)}})}catch(e){return console.error("Error initializing IndexedDB for getting conversations:",e),[]}}async function u(){try{let e=await i(),t=await l();console.log("Checking ".concat(t.length," conversations for missing userRole properties"));let n=t.filter(e=>void 0===e.userRole);if(n.length>0){for(let t of(console.log("Found ".concat(n.length," conversations with missing userRole")),n))try{let n=e.transaction([a],"readwrite").objectStore(a);console.log("Deleting conversation with missing userRole: ".concat(t.id));let o=n.delete(t.id);await new Promise((e,n)=>{o.onerror=e=>{console.error("Error deleting conversation ".concat(t.id,":"),e),n()},o.onsuccess=()=>{e()}})}catch(e){console.error("Error during deletion of conversation ".concat(t.id,":"),e)}console.log("Cleanup of conversations with missing userRole completed")}else console.log("No conversations with missing userRole found")}catch(e){console.error("Error during conversation cleanup:",e)}}async function d(e){try{let t=await i();return new Promise((n,o)=>{try{let r=t.transaction([a],"readwrite"),s=r.objectStore(a).delete(e);s.onerror=t=>{console.error("Error deleting conversation ".concat(e," from IndexedDB:"),t),o(s.error)},s.onsuccess=()=>{console.log("Conversation deleted successfully: ".concat(e)),n()},r.oncomplete=()=>{console.log("Delete transaction completed for conversation: ".concat(e))},r.onerror=t=>{console.error("Transaction error when deleting conversation: ".concat(e),t)}}catch(e){console.error("Error creating transaction for deleteConversationFromDB:",e),o(e)}})}catch(e){throw console.error("Error initializing IndexedDB for deleting conversation:",e),e}}console.log("Attempting early IndexedDB initialization"),i().catch(e=>{console.error("Early IndexedDB initialization failed:",e)});let g=new o("baun-user-data","user-data");g&&g.init().catch(e=>{console.error("Failed to initialize IndexedDB:",e)});let m=async(e,t)=>new Promise((n,o)=>{let r=indexedDB.open(e,t);r.onerror=e=>{console.error("IndexedDB error:",e),o("Error opening database")},r.onsuccess=e=>{n(e.target.result)},r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains("user-data")||t.createObjectStore("user-data")}}),h=async(e,t)=>{try{let n=t;Array.isArray(t)&&(n=t.map(e=>e&&"object"==typeof e&&e.id&&e.messages?{...e,lastUpdated:e.lastUpdated||new Date().toISOString(),synced:!1}:e));let o=await m("user-store",1);return new Promise((t,r)=>{let a=o.transaction(["user-data"],"readwrite").objectStore("user-data").put(n,e);a.onerror=()=>{console.error("Error storing data"),r("Error storing data")},a.onsuccess=()=>{t()}})}catch(e){throw console.error("Error in storeUserData:",e),e}},p=()=>"undefined"!=typeof navigator&&!0===navigator.onLine}}]);